var Violet={Util:{}};Violet.Util.uri_encode=function(b){return encodeURIComponent(b).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")};Violet.Util.mergeHash=function(){var b=arguments.length,a,e,d={};for(a=0;a<b;a++){var c=arguments[a];for(e in c)c.hasOwnProperty(e)&&(d[e]=c[e])}return d};Violet.Util.hashLength=function(b){var a,e=0;for(a in b)b.hasOwnProperty(a)&&e++;return e};
Violet.HTTPClient=function Class(a){if(!(this instanceof Class))return new Class(a);a||(a={});this.method=a.method||"GET";this.uri=a.uri||"";this.post_data={};this.authorization_header=null;this.onloading=function(){};this.onsuccess=function(){};this.onerror=function(){};this.request=null};
(function(){var b=Violet.HTTPClient.prototype;b.start=function(){if(""===this.uri)return!1;var a=new XMLHttpRequest({mozSystem:!0});a.open(this.method,this.uri,!0);null!==this.authorization_header&&a.setRequestHeader("Authorization",this.authorization_header);"POST"===this.method&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(3===a.readyState)this.onloading(a);else if(4===a.readyState)if(200===a.status)this.onsuccess(a);else this.onerror(a)}.bind(this);
a.send(this.postBody());this.request=a};b.stop=function(){this.request.abort()};b.setOAuthHeader=function(a){var b="",d=[];for(b in a)a.hasOwnProperty(b)&&(d[d.length]=b+'="'+a[b]+'"');this.authorization_header="OAuth "+d.join(", ")};b.postBody=function(){if("GET"===this.method||0===this.post_data.length)return null;var a="",b=this.post_data,d=[];for(a in b)b.hasOwnProperty(a)&&d.push(a+"="+Violet.Util.uri_encode(b[a]));return d.join("&")}})();
Violet.OAuth=function Class(a){if(!(this instanceof Class))return new Class(a);a||(a={});this.base_uri=a.uri;this.consumer_key=a.consumer_key;this.consumer_secret=a.consumer_secret;this.access_token=a.access_token;this.access_token_secret=a.access_token_secret;this.oauth_token_secret=this.oauth_token=""};
(function(){var b=Violet.OAuth.prototype;b.obtainAuthorizeURI=function(a,b){var d=Violet.HTTPClient({uri:"https://api.twitter.com/oauth/request_token",method:"POST"}),c={oauth_callback:"oob",oauth_consumer_key:this.consumer_key,oauth_nonce:this.generateNonce(32),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:String(Math.floor(new Date/1E3)),oauth_version:"1.0"};c.oauth_signature=this.generateSignature("POST","https://api.twitter.com/oauth/request_token",c,"");d.setOAuthHeader(c);d.onsuccess=function(b){b=
b.responseText.split("&");var c,d=b.length,e={};for(c=0;c<d;c++){var k=b[c].split("=");e[k[0]]=k[1]}this.oauth_token=e.oauth_token;this.oauth_token_secret=e.oauth_token_secret;a("https://api.twitter.com/oauth/authorize?oauth_token="+e.oauth_token)}.bind(this);d.onerror=b;d.start()};b.obtainAccessToken=function(a,b,d){var c=Violet.HTTPClient({uri:"https://api.twitter.com/oauth/access_token",method:"POST"});a={oauth_consumer_key:this.consumer_key,oauth_nonce:this.generateNonce(32),oauth_signature_method:"HMAC-SHA1",
oauth_timestamp:String(Math.floor(new Date/1E3)),oauth_token:this.oauth_token,oauth_verifier:a,oauth_version:"1.0"};a.oauth_signature=this.generateSignature("POST","https://api.twitter.com/oauth/access_token",a,this.oauth_token_secret);c.setOAuthHeader(a);c.onsuccess=function(a){a=a.responseText.split("&");var c,d=a.length,l={};for(c=0;c<d;c++){var k=a[c].split("=");l[k[0]]=k[1]}this.access_token=l.access_token;this.access_token_secret=l.access_token_secret;b(l)}.bind(this);c.onerror=d;c.start()};
b.obtainOAuthParams=function(a,b,d){var c={oauth_consumer_key:this.consumer_key,oauth_nonce:this.generateNonce(32),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:String(Math.floor(new Date/1E3)),oauth_token:this.access_token,oauth_version:"1.0"};c.oauth_signature=this.generateSignature(a,b,Violet.Util.mergeHash(c,d),this.access_token_secret);return c};b.generateNonce=function(a){var b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),d,c="";for(d=0;d<a;d++)c+=b[Math.floor(61*
Math.random())];return c};b.generateSignature=function(a,b,d,c){var f=[],g,h;a=a.toUpperCase()+"&"+Violet.Util.uri_encode(b)+"&";for(g in d)d.hasOwnProperty(g)&&(f[f.length]=g);f.sort();b=f.length;h=[];for(g=0;g<b;g++)h[h.length]=f[g]+"="+Violet.Util.uri_encode(d[f[g]]);a+=Violet.Util.uri_encode(h.join("&"));c||(c="");d=new jsSHA(a,"TEXT");return Violet.Util.uri_encode(d.getHMAC(this.consumer_secret+"&"+c,"TEXT","SHA-1","B64"))}})();Violet.Endpoints={};Violet.Endpoints.get="statuses/mentions_timeline;statuses/user_timeline;statuses/home_timeline;statuses/retweets_of_me;statuses/retweets/:id;statuses/show/:id;statuses/oembed;statuses/retweeters/ids;search/tweets;statuses/sample;statuses/firehose;user;site;direct_messages;direct_messages/sent;direct_messages/show;friendships/no_retweets/ids;friends/ids;followers/ids;friendships/lookup;friendships/incoming;friendships/outgoing;friendships/show;friends/list;followers/list;account/settings;account/verify_credentials;blocks/list;blocks/ids;users/lookup;users/show;users/search;users/contributees;users/contributors;users/profile_banner;users/suggestions/:slug;users/suggestions;users/suggestions/:slug/members;favorites/list;lists/list;lists/statuses;lists/memberships  ;lists/subscribers;lists/subscribers/show;lists/members/show;lists/members;lists/show;lists/subscriptions;lists/ownerships;saved_searches/list;saved_searches/show/:id;geo/id/:place_id;geo/reverse_geocode;geo/searc;geo/similar_places;trends/place;trends/available;trends/closest;oauth/authenticate;oauth/authorize  ;help/configuration;help/languages;help/privacy;help/tos;application/rate_limit_status".split(";");
Violet.Endpoints.post="statuses/destroy/:id statuses/update statuses/retweet/:id statuses/update_with_media statuses/filter direct_messages/destroy direct_messages/new friendships/create friendships/destroy friendships/update account/settings account/update_delivery_device account/update_profile_background_image account/update_profile_colors account/update_profile_image blocks/create blocks/destroy account/remove_profile_banner account/update_profile_banner favorites/destroy favorites/create lists/members/destroy lists/subscribers/create lists/subscribers/destroy lists/members/create_all lists/members/create lists/destroy lists/update lists/create lists/members/destroy_all saved_searches/create saved_searches/destroy/:id geo/place users/report_spam oauth/access_token oauth/request_token oauth2/token oauth2/invalidate_token".split(" ");
Violet.Endpoints.to_replace_id_none=["statuses/show/:id"];Violet.Endpoints.to_replace_id=["statuses/retweets/:id","statuses/retweet/:id","statuses/destroy/:id"];Violet.Endpoints.to_replace_slug=["users/suggestions/:slug/members","users/suggestions/:slug"];Violet.Endpoints.to_replace_place_id=["geo/id/:place_id"];Violet.Endpoints.method=function(b){var a=null;-1!==Violet.Endpoints.get.indexOf(b)?a="GET":-1!==Violet.Endpoints.post.indexOf(b)&&(a="POST");return a};Violet.Request={};
Violet.Request.request=function(b,a,e,d){var c=Violet.Request.generateRequestInfo(b,a);b=c.method;a=this.base_uri+c.uri;var f=c.query;if(null===b)return!1;c=Violet.HTTPClient({method:b,uri:a+c.get_data});c.setOAuthHeader(this.oauth.obtainOAuthParams(b,a,f));c.onsuccess=e;c.onerror=d;"POST"===b&&(c.post_data=f);c.start()};
Violet.Request.generateRequestInfo=function(b,a){var e=Violet.Endpoints.method(b),d="";-1!==Violet.Endpoints.to_replace_id_none.indexOf(b)?b=b.replace(/\/\:id$/,""):-1!==Violet.Endpoints.to_replace_id.indexOf(b)?(b=b.replace(":id",a.id),delete a.id):-1!==Violet.Endpoints.to_replace_slug.indexOf(b)?(b=b.replace(":slug",a.slug),delete a.slug):-1!==Violet.Endpoints.to_replace_place_id.indexOf(b)&&(b=b.replace(":place_id",a.place_id),delete a.place_id);if("GET"===e&&0<Violet.Util.hashLength(a)){var d=
"",c=[];for(d in a)a.hasOwnProperty(d)&&c.push(d+"="+Violet.Util.uri_encode(a[d]));d="?"+c.join("&")}return{method:e,uri:b+".json",query:a,get_data:d}};Violet.Streaming=function Class(a){if(!(this instanceof Class))return new Class(a);this.oauth=a;this.endpoint=this.base_uri=""};
(function(){var b=Violet.Streaming.prototype;b.start=function(a,b,d){var c=Violet.Request.generateRequestInfo(this.endpoint,d);d=c.method;var f=this.base_uri+c.uri,g=c.query,h=c.get_data;console.log(c);if(null===d)return!1;c=Violet.HTTPClient({method:d,uri:f+h});c.setOAuthHeader(this.oauth.obtainOAuthParams(d,f,g));c.onloading=function(b){b=b.responseText.split("\r\n");if(!b[b.length-2])return!1;a(JSON.parse(b[b.length-2]))};c.onerror=b;"POST"===d&&(c.post_data=g);c.start();this.connection=c};b.stop=
function(){this.connection.stop();this.connection=null}})();Violet.UserStream=function(b){b=Violet.Streaming(b);b.base_uri="https://userstream.twitter.com/1.1/";b.endpoint="user";return b};Violet.FilterStream=function(b){b=Violet.Streaming(b);b.base_uri="https://stream.twitter.com/1.1/";b.endpoint="statuses/filter";return b};
Violet.init=function Class(a){if(!(this instanceof Class))return new Class(a);this.base_uri="https://api.twitter.com/1.1/";this.consumer_key=a.consumer_key;this.consumer_secret=a.consumer_secret;this.access_token=a.access_token||"";this.access_token_secret=a.access_token_secret||"";this.initialize()};
(function(){Violet.init.prototype.initialize=function(){this.oauth=Violet.OAuth({consumer_key:this.consumer_key,consumer_secret:this.consumer_secret,access_token:this.access_token,access_token_secret:this.access_token_secret});this.streaming=this.userstream=Violet.UserStream(this.oauth);this.filterstream=Violet.FilterStream(this.oauth);this.request=Violet.Request.request.bind(this)}})();
